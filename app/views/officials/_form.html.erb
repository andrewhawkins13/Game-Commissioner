<%= form_with model: official, class: "space-y-6" do |f| %>
  <% if official.errors.any? %>
    <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-md">
      <h3 class="font-semibold mb-2"><%= pluralize(official.errors.count, "error") %> prohibited this official from being saved:</h3>
      <ul class="list-disc list-inside">
        <% official.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= f.label :name, class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_field :name, class: "w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <div>
    <%= f.label :email, class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.email_field :email, class: "w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <div>
    <%= f.label :phone, class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.telephone_field :phone, class: "w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <div>
    <%= f.label :home_address, "Home Address", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_field :home_address, placeholder: "123 Main St, City, State ZIP", class: "w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <div>
    <%= f.label :max_distance, "Maximum Travel Distance (miles)", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.number_field :max_distance, class: "w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <%= f.label :latitude, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= f.number_field :latitude, step: "any", class: "w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
    </div>
    <div>
      <%= f.label :longitude, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= f.number_field :longitude, step: "any", class: "w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
    </div>
  </div>

  <% if official.persisted? %>
    <div class="border-t border-gray-200 pt-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Roles This Official Can Fill</h3>
      <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
        <% Assignment.roles.keys.each do |role| %>
          <label class="flex items-center space-x-2 cursor-pointer">
            <%= check_box_tag "roles[]", role, official.official_roles.exists?(role: role), class: "rounded border-gray-300 text-blue-600 focus:ring-blue-500", id: "role_#{role}" %>
            <span class="text-sm font-medium text-gray-700"><%= role.upcase %></span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="border-t border-gray-200 pt-6" data-controller="dynamic-fields">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Assignment Rules</h3>
      <p class="text-sm text-gray-600 mb-3">Add natural language rules for AI assignment (e.g., "Only travels 20 miles", "Doesn't work back to back days", "Won't play at Jefferson HS")</p>
      <div data-dynamic-fields-target="container" class="space-y-3">
        <% official.rules.each_with_index do |rule, index| %>
          <div class="flex space-x-2" data-dynamic-fields-target="field">
            <input type="text" name="rules[][rule_text]" value="<%= rule.rule_text %>" class="flex-1 border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Enter a rule..." />
            <input type="hidden" name="rules[][id]" value="<%= rule.id %>" />
            <label class="flex items-center space-x-2">
              <%= check_box_tag "rules[][active]", "1", rule.active?, class: "rounded border-gray-300 text-blue-600 focus:ring-blue-500" %>
              <span class="text-sm">Active</span>
            </label>
            <button type="button" data-action="click->dynamic-fields#remove" class="text-red-600 hover:text-red-700 font-medium">Remove</button>
          </div>
        <% end %>
      </div>

      <!-- Template for new fields -->
      <template data-dynamic-fields-target="template">
        <div class="flex space-x-2" data-dynamic-fields-target="field">
          <input type="text" name="rules[][rule_text]" class="flex-1 border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Enter a rule..." />
          <label class="flex items-center space-x-2">
            <input type="checkbox" name="rules[][active]" value="1" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" />
            <span class="text-sm">Active</span>
          </label>
          <button type="button" data-action="click->dynamic-fields#remove" class="text-red-600 hover:text-red-700 font-medium">Remove</button>
        </div>
      </template>

      <button type="button" data-action="click->dynamic-fields#add" class="mt-3 text-blue-600 hover:text-blue-700 font-medium text-sm">+ Add Rule</button>
    </div>
  <% end %>

  <div class="flex space-x-4 pt-6">
    <%= f.submit class: "bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-md cursor-pointer" %>
    <%= link_to "Cancel", officials_path, class: "bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold px-6 py-2 rounded-md" %>
  </div>
<% end %>
